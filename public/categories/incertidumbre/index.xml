<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Incertidumbre on Carlos Gómez</title>
    <link>https://www.analytical.cl/categories/incertidumbre/</link>
    <description>Recent content in Incertidumbre on Carlos Gómez</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>es</language>
    <copyright>&amp;copy; 2017 Carlos Gómez</copyright>
    <lastBuildDate>Wed, 01 Nov 2017 00:00:00 +0000</lastBuildDate>
    <atom:link href="/categories/incertidumbre/" rel="self" type="application/rss+xml" />
    
    <item>
      <title>¿Cómo detectar el efecto matriz en un método analítico?</title>
      <link>https://www.analytical.cl/post/como-detectar-efecto-matriz-metodo-analitico/</link>
      <pubDate>Wed, 01 Nov 2017 00:00:00 +0000</pubDate>
      
      <guid>https://www.analytical.cl/post/como-detectar-efecto-matriz-metodo-analitico/</guid>
      <description>&lt;p&gt;He vuelto a postear, después de una gira que me llevó por los cinco… mentira, fue por pura pega.&lt;/p&gt;
&lt;p&gt;El famoso efecto matriz, algo tan etéreo como el &lt;em&gt;criterio analítico&lt;/em&gt;. El efecto matriz está íntimamente relacionado con las interferencias de la matriz que de alguna forma aumentan o disminuyen la señal instrumental que, en teoría, es producida sólo por el analito de interés.&lt;/p&gt;
&lt;p&gt;Para evaluar y detectar el efecto matriz, debemos desempolvar algunos papers que nos enseñaron el famoso método de calibración con adición conocida o adición de estándar. En este método, la matriz es nuestro medio de calibración. En vez de preparar los calibrantes en solventes puros o en solución ácida, utilizaremos la misma matriz para preparar (adicionar) el analito. De esta forma, la señal analítica de estos calibrantes, está compuesta de la señal propia del analito así como también de los interferentes, lo que permite corregir/minimizar sus efectos.&lt;/p&gt;
&lt;p&gt;Existen varias formas de implementar el método de adición conocida. Una muy buena referencia es el excelente y pedagógico paper de M. Bader:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Morris Bader “A systematic approach to standard addition methods in instrumental analysis” &lt;em&gt;J. Chem. Educ., 1980, 57 (10), p 703&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;El método consiste en añadir cantidades conocidas del analito en solvente puro o solución ácida a volúmenes iguales de matriz. Finalmente, medir la respuesta instrumental en una serie de adiciones crecientes tal como lo muestra la figura &lt;a href=&#34;#fig:mosaplot&#34;&gt;1&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&#34;figure&#34;&gt;&lt;span id=&#34;fig:mosaplot&#34;&gt;&lt;/span&gt;
&lt;img src=&#34;https://www.analytical.cl/img/mosaplot.png&#34; alt=&#34;Diseño experimental de la adición conocida. Cortesía de Lins4y via Wikimedia Commons&#34;  /&gt;
&lt;p class=&#34;caption&#34;&gt;
Figure 1: Diseño experimental de la adición conocida. Cortesía de Lins4y via Wikimedia Commons
&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Es necesario que las adiciones de analito generen, en conjunto con la cantidad de analito presente en la muestra original, una concentración tal que aún se encuentre en el rango lineal de calibración. De esta forma se otiene una curva tal como se observa en la figura &lt;a href=&#34;#fig:adicion&#34;&gt;2&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&#34;figure&#34;&gt;&lt;span id=&#34;fig:adicion&#34;&gt;&lt;/span&gt;
&lt;img src=&#34;https://www.analytical.cl/img/c0adicion.png&#34; alt=&#34;Preparación curva método de adición conocida&#34;  /&gt;
&lt;p class=&#34;caption&#34;&gt;
Figure 2: Preparación curva método de adición conocida
&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Las unidades del eje &lt;span class=&#34;math inline&#34;&gt;\(X\)&lt;/span&gt; pueden establecerse como &lt;em&gt;analito añadido&lt;/em&gt; o, tal como lo propone Bader en su paper, como múltiplos de un volumen o cantidad fija del analito. Por lo tanto, en &lt;span class=&#34;math inline&#34;&gt;\(x = 0\)&lt;/span&gt; se obtiene la señal de la muestra problema a la cual no se le ha agregado el analito, es decir, la señal original. En cada una de las adiciones del estándar mediremos la señal instrumental de tal manera de obtener, y así lo esperamos, una relación lineal entre analito agregado &lt;span class=&#34;math inline&#34;&gt;\(x\)&lt;/span&gt; y señal &lt;span class=&#34;math inline&#34;&gt;\(y\)&lt;/span&gt; de la forma:&lt;/p&gt;
&lt;span class=&#34;math display&#34; id=&#34;eq:calib&#34;&gt;\[\begin{equation}
  y = \beta_{0} + \beta_{1}x + \epsilon
    \tag{1}
\end{equation}\]&lt;/span&gt;
&lt;p&gt;donde se asumen los mismos supuestos que discutimos en el caso de la calibración lineal estándar(en solvente puro) y que puede recordar en este &lt;a href=&#34;https://www.analytical.cl/post/como-demuestro-que-mi-curva-de-calibracion-es-lineal/&#34;&gt;post&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;La concentración de la muestra problema &lt;span class=&#34;math inline&#34;&gt;\(C_{0}\)&lt;/span&gt; se obtiene a partir de la ecuación &lt;a href=&#34;#eq:c0&#34;&gt;(2)&lt;/a&gt;:&lt;/p&gt;
&lt;span class=&#34;math display&#34; id=&#34;eq:c0&#34;&gt;\[\begin{equation}
  C_{0} = \frac{\beta_{0}}{\beta_{1}}
  \tag{2}
\end{equation}\]&lt;/span&gt;
&lt;p&gt;La incertidumbre de la concentración de la muestra problema &lt;span class=&#34;math inline&#34;&gt;\(u(C_{0})\)&lt;/span&gt; se calcula a partir de la ecuación:&lt;/p&gt;
&lt;span class=&#34;math display&#34; id=&#34;eq:uc0&#34;&gt;\[\begin{equation}
  u(C_{0}) = \frac{\sigma_{y/x}}{\beta_{1}}
  \sqrt{\frac{1}{n} + \frac{\overline{y}^2}
  {\beta_{1}\sum_{i}^{n} (x_{i} - \overline{x})^2}}
    \tag{3}
\end{equation}\]&lt;/span&gt;
&lt;p&gt;donde:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;span class=&#34;math inline&#34;&gt;\(\sigma_{y/x}\)&lt;/span&gt; es la desviación estándar del error aleatorio &lt;span class=&#34;math inline&#34;&gt;\(\epsilon\)&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;&lt;span class=&#34;math inline&#34;&gt;\(n\)&lt;/span&gt; es el número de adiciones independientes del estándar&lt;/li&gt;
&lt;li&gt;&lt;span class=&#34;math inline&#34;&gt;\(\overline{y}\)&lt;/span&gt; es el promedio de las señales instrumentales de las adiciones&lt;/li&gt;
&lt;li&gt;&lt;span class=&#34;math inline&#34;&gt;\(\overline{x}\)&lt;/span&gt; es el promedio de las concentraciones&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Como puede apreciar, la expresión de la incertidumbre de calibración para el método de adición conocida es muy similar a la correspondiente calibración estandar que discutimos en un &lt;a href=&#34;https://www.analytical.cl/post/como-calcular-la-incertidumbre-de-una-curva-de-calibracion/&#34;&gt;post anterior&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Si queremos minimizar esta incertidumbre podríamos aumentar el número de adiciones &lt;span class=&#34;math inline&#34;&gt;\(n\)&lt;/span&gt; o aumentar el término &lt;span class=&#34;math inline&#34;&gt;\(\sum_{i}^{n} (x_{i} - \overline{x})^2\)&lt;/span&gt;. Este último término es interesante, pues nos dice que la incertidumbre de calibración de este método se minimiza utilizando un rango amplio de concentración de adición. Ellison demuestra que, dado que la propiedad de linealidad se mantiene, basta preparar dos puntos de calibración:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;La muestra original sin adición (&lt;span class=&#34;math inline&#34;&gt;\(x = 0\)&lt;/span&gt;)&lt;/li&gt;
&lt;li&gt;El extremo superior del rango lineal&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Por ejemplo, si por alguna razón se tuvieran que preparar &lt;span class=&#34;math inline&#34;&gt;\(n = 6\)&lt;/span&gt; adiciones, lo que indica la ecuación &lt;a href=&#34;#eq:uc0&#34;&gt;(3)&lt;/a&gt;, es que sería mejor preparar tres puntos sin adición (&lt;span class=&#34;math inline&#34;&gt;\(x = 0\)&lt;/span&gt;) y tres en el extremos superior del rango lineal, tal como lo demuestra la figura &lt;a href=&#34;#fig:doe&#34;&gt;3&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;figure&#34;&gt;&lt;span id=&#34;fig:doe&#34;&gt;&lt;/span&gt;
&lt;img src=&#34;https://www.analytical.cl/img/doeadicion.png&#34; alt=&#34;Diseño de una curva de calibración con adición conocida para minimizar la incertidumbre&#34;  /&gt;
&lt;p class=&#34;caption&#34;&gt;
Figure 3: Diseño de una curva de calibración con adición conocida para minimizar la incertidumbre
&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Para evaluar estadísticamente si existe un efecto matriz debemos comparar la curva de calibración estándar (es decir, en solvente orgánico o en solución ácida) con la curva de adición conocida. Si las pendientes de ambas curvas son “iguales” podemos afirmar que no hay evidencia de efecto matriz tal como se muestra en la figura &lt;a href=&#34;#fig:sinefecto&#34;&gt;4&lt;/a&gt;. De modo contrario, si las pendientes de ambas curvas difieren, entonces, existe un efecto matriz significativo, tal como lo indica la figura &lt;a href=&#34;#fig:conefecto&#34;&gt;5&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&#34;figure&#34;&gt;&lt;span id=&#34;fig:sinefecto&#34;&gt;&lt;/span&gt;
&lt;img src=&#34;https://www.analytical.cl/img/sinefecto.png&#34; alt=&#34;Sin efecto matriz: calibración estándar v/s adición conocida&#34;  /&gt;
&lt;p class=&#34;caption&#34;&gt;
Figure 4: Sin efecto matriz: calibración estándar v/s adición conocida
&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;figure&#34;&gt;&lt;span id=&#34;fig:conefecto&#34;&gt;&lt;/span&gt;
&lt;img src=&#34;https://www.analytical.cl/img/conefecto.png&#34; alt=&#34;Con efecto matriz: calibración estándar v/s adición conocida&#34;  /&gt;
&lt;p class=&#34;caption&#34;&gt;
Figure 5: Con efecto matriz: calibración estándar v/s adición conocida
&lt;/p&gt;
&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;Ahora, Ud. se preguntará ¿Cuál es la herramienta estadística para comparar dos pendientes de curvas de calibración?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;¡Excelente pregunta Tu(x3)!&lt;/p&gt;
&lt;p&gt;Aunque hay varias aproximaciones para hacer esta comparación, en este post utilizaremos el Análisis de Covarianza (ANCOVA) y lo implementaremos, como no, en lenguaje &lt;code&gt;R&lt;/code&gt;. La siguiente tabla muestra los datos de calibración de clorpirifos en vino por GC-NPD, tanto en solvente puro como mediante el método de adición conocida en la muestra de vino:&lt;/p&gt;
&lt;div class=&#34;figure&#34;&gt;&lt;span id=&#34;fig:tablamosa&#34;&gt;&lt;/span&gt;
&lt;img src=&#34;https://www.analytical.cl/img/tabla_mosa.png&#34; alt=&#34;Tabla datos de calibración clorpirifos&#34;  /&gt;
&lt;p class=&#34;caption&#34;&gt;
Figure 6: Tabla datos de calibración clorpirifos
&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Note que en la caso de la calibración estándar, las unidades de concentración están expresadas como &lt;span class=&#34;math inline&#34;&gt;\(\mu\)&lt;/span&gt;g de clorpirifos por mL de solvente. En cambio, en los datos de adición conocida están expresadas como &lt;span class=&#34;math inline&#34;&gt;\(\mu\)&lt;/span&gt;g de clorpirifos añadidos en los mL de muestra original. Por lo tanto, &lt;span class=&#34;math inline&#34;&gt;\(X = 0\, \mu\text{g}/\text{mL}_{\text{vino}}\)&lt;/span&gt; representa la muestra sin adición. La figura &lt;a href=&#34;#fig:mosa&#34;&gt;7&lt;/a&gt; muestra las curvas de calibración correspondientes.&lt;/p&gt;
&lt;div class=&#34;figure&#34;&gt;&lt;span id=&#34;fig:mosa&#34;&gt;&lt;/span&gt;
&lt;img src=&#34;https://www.analytical.cl/img/mosa.png&#34; alt=&#34;Curvas de calibración&#34;  /&gt;
&lt;p class=&#34;caption&#34;&gt;
Figure 7: Curvas de calibración
&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Apliquemos, ahora, el análisis de covarianza para evaluar si existen diferencias significativas entre las pendientes.&lt;/p&gt;
&lt;p&gt;Primero, ajustemos un modelo lineal para cada calibración:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# Curva de calibración estándar
x &amp;lt;- c(0, 0.1, 0.2, 0.3, 0.5, 1.0)
y &amp;lt;- c(0, 80, 159, 245, 410, 795)
fit.std &amp;lt;- lm(y ~ x)

# Curva de adición conocida
x.add &amp;lt;- c(0, 0.1, 0.2, 0.3, 0.4, 0.5)
y.add &amp;lt;- c(75, 159, 240, 328, 410, 498)
fit.add &amp;lt;- lm(y.add ~ x.add)

# En R la expresión y ~ x significa &amp;#39;y es modelado por x&amp;#39;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;A continuación se muestran los análisis estadísticos para cada curva:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;summary(fit.std)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;
Call:
lm(formula = y ~ x)

Residuals:
     1      2      3      4      5      6 
-2.489 -2.206 -2.924  3.359  8.924 -4.664 

Coefficients:
            Estimate Std. Error t value Pr(&amp;gt;|t|)    
(Intercept)    2.489      3.420   0.728    0.507    
x            797.176      7.105 112.193 3.78e-08 ***
---
Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1

Residual standard error: 5.751 on 4 degrees of freedom
Multiple R-squared:  0.9997,    Adjusted R-squared:  0.9996 
F-statistic: 1.259e+04 on 1 and 4 DF,  p-value: 3.785e-08&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;summary(fit.add)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;
Call:
lm(formula = y.add ~ x.add)

Residuals:
      1       2       3       4       5       6 
 1.1429  0.6857 -2.7714  0.7714 -1.6857  1.8571 

Coefficients:
            Estimate Std. Error t value Pr(&amp;gt;|t|)    
(Intercept)   73.857      1.463   50.49 9.21e-07 ***
x.add        844.571      4.832  174.79 6.43e-09 ***
---
Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1

Residual standard error: 2.021 on 4 degrees of freedom
Multiple R-squared:  0.9999,    Adjusted R-squared:  0.9998 
F-statistic: 3.055e+04 on 1 and 4 DF,  p-value: 6.426e-09&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;La pendiente de la curva de calibración estándar es 797 y la pendiente del método de adición es 845. ¿Es esta diferencia significativa? Esta es la pregunta que responde el ANCOVA. Para implementar este test en &lt;code&gt;R&lt;/code&gt;debemos hacer una pequeña modificación a nuestra base de datos:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# Consolidaremos los datos de calibración en una sola tabla llamada &amp;#39;datos&amp;#39;
datos &amp;lt;- data.frame(X = c(x, x.add), 
                    Y = c(y, y.add), 
                    Calibracion = c(rep(&amp;#39;Estandar&amp;#39;, 6), rep(&amp;#39;Adicion&amp;#39;, 6)))&lt;/code&gt;&lt;/pre&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr class=&#34;header&#34;&gt;
&lt;th align=&#34;left&#34;&gt;X&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Y&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Calibracion&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;left&#34;&gt;0.0&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;0&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Estandar&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;left&#34;&gt;0.1&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;80&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Estandar&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;left&#34;&gt;0.2&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;159&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Estandar&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;left&#34;&gt;0.3&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;245&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Estandar&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;left&#34;&gt;0.5&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;410&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Estandar&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;left&#34;&gt;1.0&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;795&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Estandar&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;left&#34;&gt;0.0&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;75&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Adicion&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;left&#34;&gt;0.1&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;159&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Adicion&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;left&#34;&gt;0.2&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;240&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Adicion&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;left&#34;&gt;0.3&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;328&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Adicion&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;left&#34;&gt;0.4&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;410&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Adicion&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;left&#34;&gt;0.5&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;498&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Adicion&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Una vez consolidados los datos en una única tabla podemos aplicar el análisis de covarianza en &lt;code&gt;R&lt;/code&gt; con los siguientes comandos de la librería &lt;code&gt;car&lt;/code&gt;:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(car)

# Ajustamos un modelo con interceptos distintos y una pendiente para cada
# calibración

fit &amp;lt;- lm(Y ~ X + Calibracion + X:Calibracion, data = datos)
Anova(fit, type = &amp;#39;II&amp;#39;)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;Anova Table (Type II tests)

Response: Y
              Sum Sq Df   F value    Pr(&amp;gt;F)    
X             540763  1 29108.930 1.558e-15 ***
Calibracion    20535  1  1105.398 7.309e-10 ***
X:Calibracion    310  1    16.699  0.003503 ** 
Residuals        149  8                        
---
Signif. codes:  0 &amp;#39;***&amp;#39; 0.001 &amp;#39;**&amp;#39; 0.01 &amp;#39;*&amp;#39; 0.05 &amp;#39;.&amp;#39; 0.1 &amp;#39; &amp;#39; 1&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;De la tabla se observa que el &lt;em&gt;p-value&lt;/em&gt; de la comparación de las pendientes es &lt;span class=&#34;math inline&#34;&gt;\(Pr(&amp;gt;F) = 0.0035\)&lt;/span&gt; el cual es menor a 0.05 (&lt;code&gt;X:Calibracion&lt;/code&gt;), por lo tanto, la diferencia observada entre las pendientes es, desde el punto de vista estadístico, significativa. Esto implica que existe un efecto matriz que no está corregido por la calibración en solvente. En definitiva, para este tipo de muestra, sería apropiado utilizar el método de adición conocida para la determinación de clorpirifos en vino.&lt;/p&gt;
&lt;p&gt;Ahora, esta conclusión debe ser complementada con el criterio químico y metrológico. Recuerde que la desventaja del método de adición conocida es que es necesario hacer la adición muestra a muestra. Lo que se concluye del ANCOVA está basado en un criterio puramente estadístico.&lt;/p&gt;
&lt;p&gt;Bueno estimado lector, espero haya disfrutado este post.&lt;/p&gt;
&lt;p&gt;Espero sus comentarios. Nos vemos.&lt;/p&gt;
&lt;div id=&#34;bibliografia&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Bibliografía&lt;/h2&gt;
&lt;p&gt;Ellison SL, Thompson M. &lt;strong&gt;Standard additions: myth and reality&lt;/strong&gt; (2008) &lt;em&gt;Analyst 133(8):992-7.&lt;/em&gt;&lt;/p&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>Validación de los cálculos de incertidumbre en química analítica con el método Monte Carlo. Parte II</title>
      <link>https://www.analytical.cl/post/validacion-calculos-incertidumbre-quimica-analitica-metodo-monte-carlo-parte2/</link>
      <pubDate>Sat, 23 Sep 2017 00:00:00 +0000</pubDate>
      
      <guid>https://www.analytical.cl/post/validacion-calculos-incertidumbre-quimica-analitica-metodo-monte-carlo-parte2/</guid>
      <description>&lt;p&gt;En el &lt;a href=&#34;https://www.analytical.cl/post/validacion-calculos-incertidumbre-quimica-analitica-metodo-monte-carlo/&#34;&gt;post anterior&lt;/a&gt; describimos brevemente en qué consiste el método de Monte Carlo y cómo utilizarlo para estimar la incertidumbre de medición. Finalizamos comparando la estimación de acuerdo a la guía GUM con el método de Monte Carlo siguiendo estrictamente las directrices del test de diferencias numéricas propuesto por el Suplmento 1 de la GUM.&lt;/p&gt;
&lt;p&gt;Llevamos a cabo el test de validación “a mano”, es decir, ingresamos todas las instrucciones en código &lt;code&gt;R&lt;/code&gt;. Si bien no fue difícil, existen librerías especializadas en &lt;code&gt;R&lt;/code&gt; que permiten realizar todos los cálculos de incertidumbre y validarlos utilizando funciones ya incorporadas.&lt;/p&gt;
&lt;p&gt;En &lt;code&gt;R&lt;/code&gt;existen dos librerías especializadas en cálculo de incertidumbre de métodos de medición físico-químicos:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;metRology&lt;/code&gt; desarrollada en conjunto entre los Institutos Nacionales de Metrología del Reino Unido (LGC) y de Estados Unidos (NIST). Es mantenida por Steve Ellison, el autor de la guía GUM. Puede encontrar más información &lt;a href=&#34;https://www.nist.gov/programs-projects/metrology-software-project&#34;&gt;aquí&lt;/a&gt;.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;propagate&lt;/code&gt; desarrollada por Andrej-Nikolai Spiess&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Me inclinaré por &lt;code&gt;metRology&lt;/code&gt; principalmente porque tiene el soporte de los dos centros de metrología más imporantes a nivel mundial y, ya que fue desarrollada en sus inicios por Steve Ellison, tiene un pequeño sesgo hacia la metrología química.&lt;/p&gt;
&lt;div id=&#34;ejemplo-de-validacion-de-calculos-con-libreria-metrology&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Ejemplo de validación de cálculos con librería &lt;code&gt;metRology&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;Desarrollaremos un ejemplo más extenso sobre cálculo de incertidumbre en química analítica utilizando esta librería. Iremos paso a paso, cualquier duda en la implementación nada más escríbala en los comentarios más abajo. Sin embargo, no detallaremos cómo obtener las incertidumbres de cada uno de los factores involucrados en la ecuación de medición, sino que simplemente será un dato conocido para este ejemplo. En un futuro post, desarollaremos un ejemplo completo de principio a fin, por ahora nos centraremos en utilizar &lt;code&gt;metRology&lt;/code&gt;como herramienta práctica.&lt;/p&gt;
&lt;p&gt;En este ejemplo, calcularemos la incertidumbre de un método de determinación de cobre en mineral de cobre, con digestión ácida y cuantificación mediante espetroscopía de abosrción atómica AAS. Los detalles del método analítico están fuera del alcance de este post, pero pueden ser consultados en la norma chilena NCh 3392:2016.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Seguiremos estrictamente las directrices de la GUM, por lo tanto, queda fuera de esta evaluación cualquier corrección de sesgo y/o recuperación. La discusión sobre si se debiera, o no, incorporar el sesgo en la incertidumbre es un tema que abordaremos en otro post.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;El primer paso para estimar la incertidumbre de este método es escribir la ecuación de medición:&lt;/li&gt;
&lt;/ol&gt;
&lt;span class=&#34;math display&#34; id=&#34;eq:medicion&#34;&gt;\[\begin{equation}
  \text{Cu}[\text{%}]=\frac{\text{C}_{\text{calib}}\cdot V \cdot D}{m\cdot 10000}
  \tag{1}
\end{equation}\]&lt;/span&gt;
&lt;p&gt;donde &lt;span class=&#34;math inline&#34;&gt;\(\text{C}_{\text{calib}}\)&lt;/span&gt; es la concentración de la muestra digerida interpolada en la curva de calibración &lt;span class=&#34;math inline&#34;&gt;\([\mu\text{g}\,\text{mL}^{-1}]\)&lt;/span&gt;, &lt;span class=&#34;math inline&#34;&gt;\(m\)&lt;/span&gt; es la masa de la muestra [g], &lt;span class=&#34;math inline&#34;&gt;\(V\,[\text{mL}]\)&lt;/span&gt; es el volumen del aforo final y &lt;span class=&#34;math inline&#34;&gt;\(D\)&lt;/span&gt; es un factor de dilución volumétrico, utilizado cuando es necesario. Para simplificar el problema, asumiremos que no hay dilución antes de la lectura por AAS, por lo tanto, &lt;span class=&#34;math inline&#34;&gt;\(D = 1\)&lt;/span&gt; y &lt;span class=&#34;math inline&#34;&gt;\(u_{D} = 0\)&lt;/span&gt;.&lt;/p&gt;
&lt;ol start=&#34;2&#34; style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;Identificación de las fuentes de incertidumbre&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;A continuación se enumeran las fuentes de incertidumbre asociadas a cada uno de los factores de la ecuación &lt;a href=&#34;#eq:medicion&#34;&gt;(1)&lt;/a&gt; y se describe brevemente los métodos estadísticos y de juicio experto utilizados para obtener las incertidumbres estándar correpospondientes:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;span class=&#34;math inline&#34;&gt;\(\text{C}_{\text{calib}}\)&lt;/span&gt;: La incertidumbre estándar de la concentración de una muestra problema &lt;span class=&#34;math inline&#34;&gt;\(u_{\text{C}_\text{calib}}\)&lt;/span&gt; obtenida de una curva de calibración lineal &lt;span class=&#34;math inline&#34;&gt;\(y = a + bx\)&lt;/span&gt; es calculada a partir de la siguiente expresión:&lt;/li&gt;
&lt;/ul&gt;
&lt;span class=&#34;math display&#34;&gt;\[\begin{equation}
u_{\text{C}_{\text{calib}}}=\frac{s_{y/x}}{b}\sqrt{\frac{1}{m}+\frac{1}{n}+
\frac{(C_{\text{calib}}-\overline{C})^2}{\sum(C_{i}-\overline{C})^2}}
\label{eq:ucurva}
\end{equation}\]&lt;/span&gt;
&lt;p&gt;donde &lt;span class=&#34;math inline&#34;&gt;\(s_{y/x}\)&lt;/span&gt; es la desviación estándar de la regresión, &lt;span class=&#34;math inline&#34;&gt;\(m\)&lt;/span&gt; es el número de replicados independientes de la muestra problema efectivamente analizados, &lt;span class=&#34;math inline&#34;&gt;\(n\)&lt;/span&gt; es el número de calibrantes, &lt;span class=&#34;math inline&#34;&gt;\(C_{\text{calib}}\)&lt;/span&gt; es la concentración de la muestra problema obtenida por interpolación en la curva de calibración, &lt;span class=&#34;math inline&#34;&gt;\(\overline{C}\)&lt;/span&gt; es el promedio de la concentraciones de los calibrantes. Estos parámetros pueden ser obtenidos directamente del análisis estadístico de la curva de calibración lineal. Cabe destacar que cuando se utiliza el método de mínimos cuadrados ordinarios para estimar la pendiente e intercepto de la curva, esta metodología no incorpora la incertirtumbre de la concentración de los calibrantes.&lt;/p&gt;
&lt;div class=&#34;alert alert-warning&#34;&gt;
  &lt;p&gt;Puede profundizar sobre la incertidumbre de calibración en el siguiente &lt;a href=&#34;https://www.analytical.cl/post/como-calcular-la-incertidumbre-de-una-curva-de-calibracion/&#34;&gt;post&lt;/a&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;span class=&#34;math inline&#34;&gt;\(V\)&lt;/span&gt;: La incertidumbre del volumen de aforo &lt;span class=&#34;math inline&#34;&gt;\(u_{\text{V}}\)&lt;/span&gt; es estimada a partir de la combinación de tres fuentes:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;span class=&#34;math inline&#34;&gt;\(u_{\text{tol}}\)&lt;/span&gt; La incertidumbre informada por el fabricante en el certificado original del lote de producción o aquella impresa en el material de vidrio. Esta incertidumbre es de Tipo B.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;span class=&#34;math inline&#34;&gt;\(u_{\text{rep}}\)&lt;/span&gt; Incertidumbre debido a la repetibilidad de llenado del aforo del material de vidrio. Esta incertidumbre (Tipo A) es evaluada mediante métodos estadísticos a través de la replicación (&lt;span class=&#34;math inline&#34;&gt;\(n\)&lt;/span&gt;) del llenado del material con agua destilada y el registro gravimétrico de la cantidad de agua. La incertidumbre estándar se expresa como la desviación estándar de los &lt;span class=&#34;math inline&#34;&gt;\(n\)&lt;/span&gt; replicados.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;span class=&#34;math inline&#34;&gt;\(u_{\text{temp}}\)&lt;/span&gt; La incertidumbre debido a la diferencia de temperatura registrada durante la calibración del material de vidrio y aquella que se registra durante los análisis de rutina. Esta incertidumbre expandida es expresada en la ecuación &lt;a href=&#34;#eq:uvol&#34;&gt;(2)&lt;/a&gt;:&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;span class=&#34;math display&#34; id=&#34;eq:uvol&#34;&gt;\[\begin{equation}
  U_{\text{temp}}= V\cdot \gamma_{\text{H}_{2}\text{O}} \cdot \Delta T
  \tag{2}
\end{equation}\]&lt;/span&gt;
&lt;p&gt;donde &lt;span class=&#34;math inline&#34;&gt;\(V\)&lt;/span&gt; es el volumen certificado del material de vidrio, &lt;span class=&#34;math inline&#34;&gt;\(\gamma_{\text{H}_{2}\text{O}} = 2.1\cdot 10^{-4}\,\text{°C}^{-1}\)&lt;/span&gt; es el coeficiente de expansión del agua y &lt;span class=&#34;math inline&#34;&gt;\(\Delta T\)&lt;/span&gt; es la variabilidad de la temperatura de trabajo del laboratorio en relación a la tempreratura de calibración del material. Finalmente, se obtiene asume una distribución rectangular de la variable  obteniéndose una incertidumbre estándar &lt;span class=&#34;math inline&#34;&gt;\(u_{\text{temp}}=U_{\text{temp}}/\sqrt{3}\)&lt;/span&gt; mL.&lt;/p&gt;
&lt;p&gt;Esta expresión debe utilizarse cuando exista un certificado de calibración que informe la temperatura de referencia registrada durante el proceso de certificación el cual puede provenir del mismo fabricante o de alguna institución metrológica nacional que certifique este tipo material. Generalmente la temperatura de calibración se espcifica a 20°C.&lt;/p&gt;
&lt;p&gt;La incertidumbre combinada estándar del volumen del aforo se obtiene a través de la siguiente expresión:&lt;/p&gt;
&lt;span class=&#34;math display&#34;&gt;\[\begin{equation}
u_{\text{V}} = \sqrt{u_{\text{tol}}^2+u_{\text{rep}}^2+u_{\text{temp}}^2} 
\end{equation}\]&lt;/span&gt;
&lt;ul&gt;
&lt;li&gt;&lt;span class=&#34;math inline&#34;&gt;\(m\)&lt;/span&gt; : La incertidudmbre de la masa de la muestra es obtenida directamente del certificado de la balanza emitido por el nodo de metrología física nacional u otro proveedor de calibración.&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;3&#34; style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;Cuantificación de los componentes de incertidumbre&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Como mencionamos anteriormente, no llevaremos a cabo la estimación de incertidumbre de cada uno de lo componentes, sino que asumiremos que estos datos ya están disponibles. Dedicaremos otro post a desarrollar un ejemplo completo de principio a fin.&lt;/p&gt;
&lt;ol start=&#34;4&#34; style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;Cálculo de la incertidumbre combinada total&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Aplicando las directrices de la GUM y en base a la ecuación de medición &lt;a href=&#34;#eq:medicion&#34;&gt;(1)&lt;/a&gt;, la incertidumbre estándar de la concentración de Cu por este método analítico es obtenida a partir de:&lt;/p&gt;
&lt;span class=&#34;math display&#34; id=&#34;eq:ufinal&#34;&gt;\[\begin{equation}
u_{\text{Cu}} = \text{Cu}\sqrt{\left(\frac{u_{\text{C}_\text{calib}}}{\text{C}_{\text{calib}}}\right)^2+
\left(\frac{u_{\text{m}}}{m}\right)^2+
\left(\frac{u_{\text{V}}}{V}\right)^2}
\tag{3}
\end{equation}\]&lt;/span&gt;
&lt;p&gt;La tabla &lt;a href=&#34;#tab:udata&#34;&gt;1&lt;/a&gt; muestra las incertidumbres estándares de cada uno de los componentes de la ecuación &lt;a href=&#34;#eq:ufinal&#34;&gt;(3)&lt;/a&gt;:&lt;/p&gt;
&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;
&lt;table class=&#34;table table-striped&#34; style=&#34;margin-left: auto; margin-right: auto;&#34;&gt;
&lt;caption&gt;
&lt;span id=&#34;tab:udata&#34;&gt;Table 1: &lt;/span&gt;Valores e incertidumbres estándar de cada componente
&lt;/caption&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left;&#34;&gt;
Componente
&lt;/th&gt;
&lt;th style=&#34;text-align:left;&#34;&gt;
Valor
&lt;/th&gt;
&lt;th style=&#34;text-align:left;&#34;&gt;
u
&lt;/th&gt;
&lt;th style=&#34;text-align:left;&#34;&gt;
Unidades
&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
Concentracion calibracion
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
13.82
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
0.24
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
ug/mL
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
Volumen aforo
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
250.00
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
0.14
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
mL
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
Masa muestra
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
0.99160
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
0.00005
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
g
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Ok, vamos entonces a utilizar la librería &lt;code&gt;metRology&lt;/code&gt; para evaluar la incertidumbre del % de Cu.&lt;/p&gt;
&lt;div class=&#34;alert alert-warning&#34;&gt;
  &lt;p&gt;Debe, en primer lugar, instalar la librería mediante el comando &lt;code&gt;install.packages(&amp;lsquo;metRology&amp;rsquo;)&lt;/code&gt;&lt;/p&gt;

&lt;/div&gt;

&lt;p&gt;Una vez instalada debe ingresar el siguiente código &lt;code&gt;R&lt;/code&gt;:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(metRology)  # Carga la librería metRology

# Ingresar los valores de cada variable input (Tabla 1)

Cu.calib &amp;lt;- 13.82 # Concentración interpolada en la curva de calibración [ug/mL]
V &amp;lt;- 250          # Volumen de aforo [mL]
m &amp;lt;- 0.9916       # Masa de la muestra [g]
D &amp;lt;- 1            # Factor de dilución (D = 1 implica no hay dilución)

# Ingresar las incertidumbres estándar de cada variable input (Tabla 1)
# Se mantienen, obviamente, las mismas unidades

u.Cu.calib &amp;lt;- 0.24
u.V &amp;lt;- 0.14
u.m &amp;lt;- 0.00005
u.D &amp;lt;- 0

# Ingresamos la ecuación de medición y la guardamos con el nombre C.Cu
# mediante el comando &amp;#39;expression&amp;#39;

C.Cu &amp;lt;- expression(Cu.calib*V*D/(m*10000))

# Guardemos en una lista los valores de cada variable input, la llamaremos
# x.Cu

x.Cu &amp;lt;- list(Cu.calib = Cu.calib, V = V , D = D, m = m)

# Guardemos en un vector las incertidumbres estándares de cada variable input
# ¡¡en el mismo orden que fueron ingresadas en x.Cu!!
# Llamaremos a este vector u.x.Cu

u.x.Cu &amp;lt;- c(u.Cu.calib, u.V, u.D, u.m)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;¡Estamos listos! Ahora &lt;code&gt;metRology&lt;/code&gt;hará todo el trabajo con el comando &lt;code&gt;uncert&lt;/code&gt;, Ud. debe elegir cuál método de estimación desea utilizar, las opciones son:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;GUM&lt;/li&gt;
&lt;li&gt;Monte Carlo&lt;/li&gt;
&lt;li&gt;Kragten: Método numérico basado en una aproximación de las derivadas parciales propuestas por GUM. Es una excelente alternativa y muy sencilla de implementar en Excel también.&lt;/li&gt;
&lt;li&gt;NUM y k2 son otras aproximaciones numéricas de derivadas parciales.&lt;/li&gt;
&lt;/ul&gt;
&lt;ol style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;Cálculo de incertidumbre de acuerdo a GUM:&lt;/li&gt;
&lt;/ol&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# Ingresamos ¡en este orden! los siguientes parámetros del comando uncert
# Ecuación de medición C.Cu
# Lista de valores inputs x.Cu
# Vector de incertidumbres estándar u.x.Cu
# ¿Con cuál método quiere calcular la incertidumbre? En este caso GUM

u.Cu.GUM &amp;lt;- uncert(C.Cu, x.Cu, u.x.Cu, method = &amp;#39;GUM&amp;#39;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;La información que entrega &lt;code&gt;uncert&lt;/code&gt;es muy completa, sin embargo, para nuestro propósito sólo debemos fijarnos en el resultado que aparece al final del análisis, es decir: &lt;span class=&#34;math inline&#34;&gt;\(y = 0.3484268\)&lt;/span&gt; % Cu y &lt;span class=&#34;math inline&#34;&gt;\(u(y) = 0.006054\)&lt;/span&gt; % Cu.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
Uncertainty evaluation

Call:
  uncert.expression(obj = C.Cu, x = x.Cu, u = u.x.Cu, method = &amp;quot;GUM&amp;quot;)

Expression: Cu.calib * V * D/(m * 10000)

Evaluation method:  GUM 

Uncertainty budget:
         x        u       c            u.c          
Cu.calib  13.8200 0.24000  0.025211779  6.050827e-03
V        250.0000 0.14000  0.001393707  1.951190e-04
D          1.0000 0.00000  0.348426785  0.000000e+00
m          0.9916 0.00005 -0.351378363 -1.756892e-05

   y:  0.3484268
u(y):  0.006053998 &lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Además de los cálculos de incertidumbre, la opción &lt;code&gt;method = &#39;GUM&#39;&lt;/code&gt; entrega 4 gráficos muy interesantes, siendo el más importante el de &lt;em&gt;Contribuciones combinadas&lt;/em&gt;, el cual se muestra en la figura &lt;a href=&#34;#fig:plotGUM&#34;&gt;1&lt;/a&gt;. En este gráfico queda en evidencia que el factor que más aporta a la incertidumbre total (evaluada por GUM) es la curva de calibración.&lt;/p&gt;
&lt;div class=&#34;figure&#34;&gt;&lt;span id=&#34;fig:plotGUM&#34;&gt;&lt;/span&gt;
&lt;img src=&#34;https://www.analytical.cl/post/2017-09-23-validacion-de-los-calculos-de-incertidumbre-en-quimica-analitica-con-el-metodo-monte-carlo-parte2_files/figure-html/plotGUM-1.png&#34; alt=&#34;Gráfico de contribución a la incertidumbre total&#34; width=&#34;672&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;
Figure 1: Gráfico de contribución a la incertidumbre total
&lt;/p&gt;
&lt;/div&gt;
&lt;ol start=&#34;2&#34; style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;Cálculo de incertidumbre de acuerdo a Monte Carlo:&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Esencialmente es el mismo comando que utilizamos para GUM, sólo que seleccionaremos &lt;code&gt;method = &#39;MC&#39;&lt;/code&gt;. Sin embargo, este método tiene varias opciones adicionales muy interesantes:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Con la opción &lt;code&gt;distrib&lt;/code&gt; Ud. puede asignar a cada variable su respectiva distribución de probabilidad: Normal, uniforme, triangular o Student. Por defecto, asume que todas son normales.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Con la opción &lt;code&gt;B&lt;/code&gt; indica el número de simulaciones. Por defecto &lt;code&gt;B = 200&lt;/code&gt;. Le sugiero cambiar a &lt;code&gt;B = 10000&lt;/code&gt;.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# Guardaremos los cálculos en el objeto u.Cu.MC

set.seed(123) # Sólo para que Ud. obtenga los mismos resultados

u.Cu.MC &amp;lt;- uncert(C.Cu, x.Cu, u.x.Cu, method = &amp;#39;MC&amp;#39;, B = 10000)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;El método de Monte Carlo entrega el siguiente análisis:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
Uncertainty evaluation

Call:
  uncert.expression(obj = C.Cu, x = x.Cu, u = u.x.Cu, method = &amp;quot;MC&amp;quot;,     B = 10000)

Expression: Cu.calib * V * D/(m * 10000)

Evaluation method:  MC 

Budget:
         x        u       c            u.c           distrib
Cu.calib  13.8200 0.24000  0.025211842  6.050842e-03 norm   
V        250.0000 0.14000  0.001393355  1.950696e-04 norm   
D          1.0000 0.00000           NA            NA norm   
m          0.9916 0.00005 -0.351680471 -1.758402e-05 norm   
         distrib.pars         
Cu.calib mean=13.82, sd=0.24  
V        mean=250, sd=0.14    
D        mean=1, sd=0         
m        mean=0.9916, sd=5e-05

   y:  0.3484268
u(y):  0.006046603 

Monte Carlo evaluation using 10000 replicates:

   y:
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.3252  0.3444  0.3484  0.3484  0.3525  0.3720 &lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;El MMC obtiene &lt;span class=&#34;math inline&#34;&gt;\(y = 0.3484268\)&lt;/span&gt; % Cu y &lt;span class=&#34;math inline&#34;&gt;\(u(y) = 0.0060466\)&lt;/span&gt; % Cu.&lt;/p&gt;
&lt;p&gt;La tabla &lt;a href=&#34;#tab:comparacion&#34;&gt;2&lt;/a&gt; muestra la comparación de ambas aproximaciones en la estimación de la incertidumbre estándar:&lt;/p&gt;
&lt;table&gt;
&lt;caption&gt;
&lt;span id=&#34;tab:comparacion&#34;&gt;Table 2: &lt;/span&gt;Cuadro comparativo GUM v/s Monte Carlo % Cu
&lt;/caption&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left;&#34;&gt;
Método
&lt;/th&gt;
&lt;th style=&#34;text-align:left;&#34;&gt;
Valor calculado
&lt;/th&gt;
&lt;th style=&#34;text-align:left;&#34;&gt;
u
&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
GUM
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
0.3484268
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
0.0060540
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
Monte Carlo
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
0.3484268
&lt;/td&gt;
&lt;td style=&#34;text-align:left;&#34;&gt;
0.0060466
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Note la excelente concordancia entre ambas metodologías &lt;strong&gt;para esta ecuación de medición asumiendo una distribución normal para todas las variables inputs&lt;/strong&gt;. En este caso, &lt;em&gt;muy particular&lt;/em&gt;, casi sería innecesario validar el método GUM, pero lo haremos de todas maneras para ejemplificar la operación.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;validacion-de-los-calculos-gum-con-el-metodo-de-monte-carlo&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Validación de los cálculos GUM con el método de Monte Carlo&lt;/h2&gt;
&lt;p&gt;En el &lt;a href=&#34;https://www.analytical.cl/post/validacion-calculos-incertidumbre-quimica-analitica-metodo-monte-carlo/&#34;&gt;post anterior&lt;/a&gt; hicimos el test de validación numérica “a mano”, en esta oportunidad utilizaremos el comando &lt;code&gt;GUM.validate&lt;/code&gt;. Lamentablemente este comando tiene una forma distinta de ingresar los parámetros, nada del otro mundo, pero es distinta a &lt;code&gt;uncert&lt;/code&gt;:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# Si bien GUM.validate tiene muchas opciones, utilizaremos aquellas
# que están por defecto en la librería

# Guarde en un vector el nombre de las variables, cada una entre &amp;#39; &amp;#39;
variables &amp;lt;- c(&amp;#39;Cu.calib&amp;#39;, &amp;#39;V&amp;#39;, &amp;#39;D&amp;#39;, &amp;#39;m&amp;#39;)

# Guarde en un vector x.i los valores de la variables input en el 
# mismo orden que ingresó &amp;#39;variables&amp;#39; arriba
x.i &amp;lt;- c(13.82, 250, 1, 0.9916)

# Guarde en un vector u.i las incertidumbres estándar de las variables
# input, en el mismo orden que ingresó &amp;#39;variables&amp;#39; arriba
u.i &amp;lt;- c(0.24, 0.14, 0, 0.00005)

# Guarde los grados de libertad de cada variable input como nu.i. 
# En este ejemplo  asumiremos que todas tienen infinitos grados de 
# libertad (nu = 9999)

nu.i &amp;lt;- c(9999, 9999, 9999, 9999)

# Seleccione que tipo de método utilizó para evaluar cada una de las
# incertidumbres: Tipo A o tipo B. En este caso sólo la incertidumbre
# de calibración u.Cu.calib es de tipo A.

type &amp;lt;- c(&amp;#39;A&amp;#39;, &amp;#39;B&amp;#39;, &amp;#39;B&amp;#39;, &amp;#39;B&amp;#39;)

# Seleccione que distribuciones de probabilidad asignó a las variables
# input. En este ejemplo, asumiremos que todas son normales

distribution &amp;lt;- rep(&amp;#39;Normal&amp;#39;, 4) # Repetir Normal 4 veces (soy muy flojo)

# Guarde la ecuación de medición entre &amp;#39;&amp;#39;
ec_de_medicion &amp;lt;- &amp;#39;Cu.calib*V*D/(m*10000)&amp;#39;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Listo, ahora validemos los cálculos GUM con el comando &lt;code&gt;GUM.validate&lt;/code&gt;:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;set.seed(126) # Tu ya sabes
GUM.validate(var.name = variables, 
             x.i = x.i,
             u.i = u.i,
             nu.i = nu.i,
             type = type,
             distribution = distribution,
             measurement.fnc = ec_de_medicion)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;[1] 0.958&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;“Bueno ¿Y?” se preguntará Ud.&lt;/p&gt;
&lt;p&gt;Bien, para validar el método GUM frente a Monte Carlo, fíjese en el valor que entrega &lt;code&gt;GUM.validate = 0.958&lt;/code&gt; y compárelo con 0.95. Si el valor de &lt;code&gt;GUM.validate&lt;/code&gt; &lt;span class=&#34;math inline&#34;&gt;\(&amp;gt; 0.95\)&lt;/span&gt; entonces el método GUM queda validado.&lt;/p&gt;
&lt;p&gt;En el fondo, &lt;code&gt;GUM.validate&lt;/code&gt; evalúa si el intervalo de incertidumbre calculado por GUM alcanza o no la cobertura esperada del 95% (teórica).&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;resumiendo&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Resumiendo&lt;/h2&gt;
&lt;ol style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;&lt;p&gt;El método de Monte Carlo funciona en casos donde las suposiciones del método GUM no se cumplen, especialmente en ecuaciones de medición no lineales.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Mientras más divergencia de la linealidad tenga el modelo de medición, más discrepancias habrá entre ambos métodos.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Es posible que cuando incorpore distribuciones rectangulares (uniformes), el histograma de los valores de Monte Carlo esté dominado por este tipo de distribuciones. Verá un achatamiento del histograma.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Ya hablamos que la pureza química (al menos para compuestos muy puros &lt;span class=&#34;math inline&#34;&gt;\(&amp;gt; 95\%\)&lt;/span&gt;) no es correcto modelarla mediante una distribución Normal (¿&lt;span class=&#34;math inline&#34;&gt;\(99.7 \pm 0.5\)&lt;/span&gt; %?), sino con una Beta. Lamentablmente, la librería &lt;code&gt;metRology&lt;/code&gt;no posee esta distribución en sus opciones y tendrá que hacer la simulación “a mano”.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;En general para distribuciones de Monte Carlos muy asimétricas (como la pureza química modelada con Beta), la diferencia entre MC y GUM se verá reflejada en la incertidumbre expandida y no en la estándar.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Quedan muchas cosas por analizar del método de Monte Carlo, sin embargo, el espíritu de este post es divulgar a la comunidad químico-analítica esta poderosa herramienta más que entrar en los detalles teóricos.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Usamos el lenguaje &lt;code&gt;R&lt;/code&gt;porque es actualmente el &lt;em&gt;idioma oficial&lt;/em&gt; de la estadística. Sin embargo, Ud. puede implementar estos cálculos en cualquier lenguaje e incluso en Excel. Además, existen muchos otros softwares que, aunque no tan flexibles y potentes como &lt;code&gt;R&lt;/code&gt;, harán el trabajo. Revise la siguiente lista en &lt;a href=&#34;https://en.wikipedia.org/wiki/List_of_uncertainty_propagation_software&#34;&gt;Wikipedia&lt;/a&gt;.&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Espero que este post haya sido de su agrado, todos los comentarios son bienvenidos. Hasta la próxima.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;bibliografia&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Bibliografía&lt;/h2&gt;
&lt;ol style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;&lt;p&gt;Evaluation of measurement data – Guide to the expression of uncertainty in measurement JCGM 100:2008&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Evaluation of measurement data – Supplement 1 to the “Guide to the expression of uncertainty in measurement” – Propagation of distributions using a Monte Carlo method JCGM 101:2008&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Stephen L R Ellison &lt;em&gt;metRology: Support for Metrological Applications&lt;/em&gt; R package version 0.9-23-2, 2016.&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>Validación de los cálculos de incertidumbre en química analítica con el método Monte Carlo. Parte I</title>
      <link>https://www.analytical.cl/post/validacion-calculos-incertidumbre-quimica-analitica-metodo-monte-carlo/</link>
      <pubDate>Wed, 20 Sep 2017 00:00:00 +0000</pubDate>
      
      <guid>https://www.analytical.cl/post/validacion-calculos-incertidumbre-quimica-analitica-metodo-monte-carlo/</guid>
      <description>&lt;p&gt;De acuerdo al numeral 8.1 del Suplemento 1 de la guía GUM, el método de Monte Carlo es un método general para estimar la incertidumbre de medición y puede, bajo ciertas directrices, validar los cálculos realizados con el método GUM. En este post asumiremos que Ud., esimado lector, está familiarizado con el método GUM y ya lo tiene implementado , por ejemplo, en una hoja Excel y le gustaría validar sus cálculos mediante un método totalmente independiente y más general. De esta forma podrá cumplir cabalmente con el siguiente numeral de la norma 17025:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;5.4.7.1 Los cálculos y la transferencia de los datos deben estar sujetos a verificaciones adecuadas llevadas a cabo de una manera sistemática.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;¿Cómo sabe Ud. que su implementación en Excel está correcta?&lt;/p&gt;
&lt;div id=&#34;que-es-el-metodo-de-monte-carlo&#34; class=&#34;section level1&#34;&gt;
&lt;h1&gt;¿Qué es el método de Monte Carlo?&lt;/h1&gt;
&lt;p&gt;(Aquí podría hacer copy-paste de Wikipedia…no olvidar borrar esta nota interna)&lt;/p&gt;
&lt;p&gt;Muy sucintamente, el método de Monte Carlo es un método numérico que permite evaluar expresiones matemáticas complejas (muy complejas, créame) mediante la simulación de números aleatorios. Este post no pretende profundizar en la teoría de este método (ZzzZzz…) , sino más bien dar ejemplos concretos aplicados en química analítica, por lo tanto, es posible que un avezado estadístico computacional le dé un infarto al leer la soltura con la cual me expreso y lo ineficiente del código &lt;code&gt;R&lt;/code&gt;. El objetivo es simplemente la divulgación a la comunidad químico-analítica para abordar algunos puntos normativos de la 17025 y guía GUM.&lt;/p&gt;
&lt;p&gt;Veamos un ejemplo sencillo. Supongamos que necesitamos calcular la incertidumbre de la suma de 2 variables aleatorias normales &lt;strong&gt;independientes&lt;/strong&gt;, y que poseen&lt;br /&gt;
la misma media (&lt;span class=&#34;math inline&#34;&gt;\(\mu\)&lt;/span&gt;) y varianza (&lt;span class=&#34;math inline&#34;&gt;\(\sigma^2\)&lt;/span&gt;), es decir, si &lt;span class=&#34;math inline&#34;&gt;\(Z = X + Y\)&lt;/span&gt; ¿Cuál es la incertiumbre de &lt;span class=&#34;math inline&#34;&gt;\(Z\)&lt;/span&gt;? (&lt;span class=&#34;math inline&#34;&gt;\(u_{Z}\)&lt;/span&gt;)&lt;/p&gt;
&lt;p&gt;Si Ud. recuerda de sus cursos de probabilidades, este problema tiene una solución directa y sencilla:&lt;/p&gt;
&lt;span class=&#34;math display&#34;&gt;\[\begin{eqnarray}
  V(Z) &amp;amp;=&amp;amp; V(X) + V(Y) \\
  V(Z) &amp;amp;=&amp;amp; \sigma^2 + \sigma^2 \\
  V(Z) &amp;amp;=&amp;amp; 2\sigma^2
\end{eqnarray}\]&lt;/span&gt;
&lt;p&gt;donde &lt;span class=&#34;math inline&#34;&gt;\(V()\)&lt;/span&gt; denota varianza. Por lo tanto, la incertidumbre de Z es &lt;span class=&#34;math inline&#34;&gt;\(u_{Z} = \sqrt{V(Z)} = \sqrt{2}\sigma\)&lt;/span&gt;. Si Ud, conoce &lt;span class=&#34;math inline&#34;&gt;\(\sigma\)&lt;/span&gt;, es decir, la incertidumbre estándar de &lt;span class=&#34;math inline&#34;&gt;\(X\)&lt;/span&gt; e &lt;span class=&#34;math inline&#34;&gt;\(Y\)&lt;/span&gt;, el problema está resuelto. En realidad, este ejemplo es bastente general y las distribuciones ni siquiera tienen que ser las mismas, bajo ciertas condiciones, esto se cumplirá.&lt;/p&gt;
&lt;p&gt;Pero supongamos que, repentinamente, Ud. olvidó todo lo aprendido en esas estimulantes clases de probabilidades con 33°C y sin aire acondicionado. No se preocupe, obtendremos la incertidumbre de Z sin recurrir a ninguna propiedad teórica de las varianzas. Usareemos el método de Monte Carlo, para lo cual debemos hacer lo siguiente:&lt;/p&gt;
&lt;ol style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;&lt;p&gt;Asigne a cada variable, en este caso &lt;span class=&#34;math inline&#34;&gt;\(X\)&lt;/span&gt; e &lt;span class=&#34;math inline&#34;&gt;\(Y\)&lt;/span&gt;, una distribución de probabilidad de acuerdo a la información que disponga hasta ese momento. En nuestro ejemplo tanto &lt;span class=&#34;math inline&#34;&gt;\(X\)&lt;/span&gt; como &lt;span class=&#34;math inline&#34;&gt;\(Y\)&lt;/span&gt; son normales con la misma media (&lt;span class=&#34;math inline&#34;&gt;\(\mu\)&lt;/span&gt;) y desviación estándar (&lt;span class=&#34;math inline&#34;&gt;\(\sigma\)&lt;/span&gt;). Sin pérdida de generalidad, diremos que ambas variables &lt;span class=&#34;math inline&#34;&gt;\(X\)&lt;/span&gt; e &lt;span class=&#34;math inline&#34;&gt;\(Y\)&lt;/span&gt; son normales con media &lt;span class=&#34;math inline&#34;&gt;\(\mu = 100\)&lt;/span&gt; y desviación estándar &lt;span class=&#34;math inline&#34;&gt;\(\sigma = 5\)&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;De cada variable genere un valor aleatorio. Es decir, en nuestro ejemplo debemos generar un número aleatorio para &lt;span class=&#34;math inline&#34;&gt;\(X\)&lt;/span&gt; y otro para &lt;span class=&#34;math inline&#34;&gt;\(Y\)&lt;/span&gt; a partir de sus respectivas distribuciones de probabilidad asignadas, que en este caso es la misma. Haremos esto en lenguaje &lt;code&gt;R&lt;/code&gt;:&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# Generamos n = 1 número aletorio para X a partir de una
# distribución Normal con media 100 y desviación estándar 5
X &amp;lt;- rnorm(1, 100, 5) 

# Generamos n = 1 número aletorio para Y a partir de una
# distribución Normal con media 100 y desviación estándar 5
Y &amp;lt;- rnorm(1, 100, 5) &lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;En esta primera simulación obtuvimos &lt;span class=&#34;math inline&#34;&gt;\(X = 97.1976218\)&lt;/span&gt; e &lt;span class=&#34;math inline&#34;&gt;\(Y = 98.8491126\)&lt;/span&gt;.&lt;/p&gt;
&lt;ol start=&#34;3&#34; style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;&lt;p&gt;Calcule la variable de interés con los datos simulados. En el ejemplo, &lt;span class=&#34;math inline&#34;&gt;\(Z = X + Y = 97.1976218 + 98.8491126= 196.0467343\)&lt;/span&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Repita los pasos 2 y 3 &lt;span class=&#34;math inline&#34;&gt;\(n\)&lt;/span&gt; veces y obtenga la distribución empírica de &lt;span class=&#34;math inline&#34;&gt;\(Z\)&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;A partir de los &lt;span class=&#34;math inline&#34;&gt;\(n\)&lt;/span&gt; datos simulados de &lt;span class=&#34;math inline&#34;&gt;\(Z\)&lt;/span&gt;, estime &lt;span class=&#34;math inline&#34;&gt;\(u_{Z} = s_{Z}\)&lt;/span&gt;, es decir, la desviación estándar muestral de los &lt;span class=&#34;math inline&#34;&gt;\(n\)&lt;/span&gt; datos.&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Hay varias formas de implementar todos estos pasos en &lt;code&gt;R&lt;/code&gt;, la más intuitiva (creo yo) es la siguiente:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;n &amp;lt;- 1000 # Obtendremos n = 1000 datos aleatorios para X e Y
mu &amp;lt;- 100 # Media mu = 100
s &amp;lt;- 5    # Desviación estandar s = 5

X &amp;lt;- rnorm(n, mu, s) # 1000 datos aleatorios de una normal con parámetros mu y s
Y &amp;lt;- rnorm(n, mu, s) # 1000 datos aleatorios de una normal con parámetros mu y s

Z &amp;lt;- X + Y # Para cada uno de los 1000 datos de X e Y, calculamos Z

uZ &amp;lt;- sd(Z) # La incertidumbre estándar de Z es la desviación estándar de las
            # n = 1000 simulaciones&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;En nuestro ejemplo, la incertidumbre estándar por Monte Carlo es de &lt;span class=&#34;math inline&#34;&gt;\(u_{Z}^{MC} = 7.4\)&lt;/span&gt;. ¿Qué nos decía la teoría? Que &lt;span class=&#34;math inline&#34;&gt;\(u_{Z} = \sqrt{2}\sigma = \sqrt{2}\cdot 5 = 7.1\)&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Ojalá todo fuera tan fácil. El ejemplo era muy sencillo y la solución es conocida en forma teórica. La vida del químico analítico es extremadamente compleja (en todo $entido), y no siempre existe una solución tan simple. Para eso está el método de Monte Carlo, el cual simula un proceso complejo cuyas variables de entrada pueden tener cualquier distribución de probabilidad tal como lo muestra la siguiente figura:&lt;/p&gt;
&lt;div class=&#34;figure&#34;&gt;
&lt;img src=&#34;https://www.analytical.cl/img/mc2.png&#34; width=&#34;500&#34; /&gt;

&lt;/div&gt;
&lt;p&gt;La generalidad del método MC no asume normalidad de la variable de interés &lt;span class=&#34;math inline&#34;&gt;\(g(y)\)&lt;/span&gt;, sino más bien la estima como una distribución empírica y a partir de ésta calcula la incertidumbre estándar y expandida.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;incertidumbre-de-un-factor-de-dilucion&#34; class=&#34;section level1&#34;&gt;
&lt;h1&gt;Incertidumbre de un factor de dilución&lt;/h1&gt;
&lt;p&gt;Para aterrizar esta definición veamos un ejemplo muy simple en química analítica y cómo podemos implementarlo en un lenguaje de programación especialmente dedicado a esta tareas: &lt;code&gt;R&lt;/code&gt;. A su vez discutiremos las principales diferencias entre el método GUM y el método de Monte Carlo&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Se prepara la dilución de una muestra antes de su lectura por AAS, mediante la toma de una alícuota de 20 mL con una pipeta volumétrica cuyo volumen es &lt;span class=&#34;math inline&#34;&gt;\(20,0 \pm 0,1\)&lt;/span&gt; mL y su dilución en un matraz de 100 mL, con un volumen de &lt;span class=&#34;math inline&#34;&gt;\(100 \pm 0,6\)&lt;/span&gt; mL. Calcular la incertidumbre del factor de dilución &lt;span class=&#34;math inline&#34;&gt;\(f = V_{final}/V_{inicial}\)&lt;/span&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div id=&#34;metodo-gum&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Método GUM&lt;/h2&gt;
&lt;p&gt;Este es un ejercicio bastante simple para el método GUM, pues el factor de dilución es una operación de división, por lo que aplicando las reglas de propagación de la incertidumbre de una división, obtenemos lo siguiente:&lt;/p&gt;
&lt;span class=&#34;math display&#34; id=&#34;eq:f&#34;&gt;\[\begin{equation}
  u_{f} = f\sqrt{\left(\frac{u_{V_{final}}}{V_{final}}\right)^2 + 
  \left(\frac{u_{V_{inicial}}}{V_{incial}}\right)^2}
  \tag{1}
\end{equation}\]&lt;/span&gt;
&lt;p&gt;Asumiremos por simplicidad que las incertidumbres asociadas al material volumétrico son las indicadas por el fabricante en el mismo material, es decir, de acuerdo a la figura &lt;a href=&#34;#fig:matraz&#34;&gt;1&lt;/a&gt; y, por ahora, serán las únicas fuentes de incertidumbre del material volumétrico (olvidaremos la T° y la repetibilidad).&lt;/p&gt;
&lt;div class=&#34;figure&#34;&gt;&lt;span id=&#34;fig:matraz&#34;&gt;&lt;/span&gt;
&lt;img src=&#34;https://www.analytical.cl/img/pipeta.jpg&#34; alt=&#34;Incertidumbre del fabricante&#34;  /&gt;
&lt;p class=&#34;caption&#34;&gt;
Figure 1: Incertidumbre del fabricante
&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Ahora bien, las incertidumbres del material volumétrico corresponden a incertidumbres expandidas &lt;span class=&#34;math inline&#34;&gt;\(U\)&lt;/span&gt;, por lo tanto, debemos convertirlas a incertidumbres estándares antes de aplicar la ecuación &lt;a href=&#34;#eq:f&#34;&gt;(1)&lt;/a&gt;. También por simplicidad, modelaremos los volúmenes mediante una distribución rectangular, por lo tanto, al estandarizar &lt;span class=&#34;math inline&#34;&gt;\(u = U/k\)&lt;/span&gt;, con &lt;span class=&#34;math inline&#34;&gt;\(k = \sqrt{3}\)&lt;/span&gt; obtenemos lo siguiente:&lt;/p&gt;
&lt;span class=&#34;math display&#34;&gt;\[\begin{eqnarray}
  u_{V_{final}} &amp;amp;=&amp;amp; \frac{0,6}{\sqrt{3}} = 0.35\, \text{mL}\\
  u_{V_{incial}} &amp;amp;=&amp;amp; \frac{0,1}{\sqrt{3}} = 0.06\, \text{mL}\\
  u_{f} &amp;amp;=&amp;amp; \frac{100}{20}\sqrt{\left(\frac{0.35}{100}\right)^2 + 
  \left(\frac{0.06}{20}\right)^2} \\
    u_{f} &amp;amp;=&amp;amp;  0.02255
\end{eqnarray}\]&lt;/span&gt;
&lt;p&gt;En este ejemplo, podemos asumir que los grados de libertad de ambas incertidumbres tienden a infinito, por lo tanto, si queremos obtener la incertidumbre expandida del factor de dilución con un 95% de confianza, se asume un factor de cobertura &lt;span class=&#34;math inline&#34;&gt;\(k = 2\)&lt;/span&gt;, de esta forma obtenemos &lt;span class=&#34;math inline&#34;&gt;\(U_{f} = ku_{f} = 0.04509\)&lt;/span&gt; mL.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;metodo-de-monte-carlo&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Método de Monte Carlo&lt;/h2&gt;
&lt;p&gt;Implementaremos en &lt;code&gt;R&lt;/code&gt;, los pasos descritos del método de Monte Carlo:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;k &amp;lt;- sqrt(3) # Factor de estandarización para una distribución rectangular
vi &amp;lt;- 20     # Volumen inicial [mL]
Uvi &amp;lt;- 0.1   # Incertidumbre expandida del volumen inicial [mL]
uvi &amp;lt;- Uvi/k # Incertidumbre estándar del volumen inicial [mL]
vf &amp;lt;- 100    # Volumen incial [mL]
Uvf &amp;lt;- 0.6   # Incertidumbre expandida del volumen final [mL]
uvf &amp;lt;- Uvf/k # Incertidumbre estándar del volumen final [mL]

# Aquí haremos la simulación de Monte Carlo
set.seed(123) # Para que Ud. obtenga los mismos resultados en su simulación

# Generaremos valores aleatorios de volumen inicial y volumen final
# desde una distribución rectangular con el comando runif(n, minimo, maximo)
# minimo = volumen - U
# maximos = volumen + U
# Los guardaremos en los vectores vi.sim y vf.sim

n &amp;lt;- 1000
vi.sim &amp;lt;- runif(n, vi - Uvi, vi + Uvi)
vf.sim &amp;lt;- runif(n, vf - Uvf, vf + Uvf)

# Ahora calcularemos el factor de dilución para cada uno de los pares de 
# valores de volumen inicial y final que simulamos y lo guardaremos en el
# el vector f.sim

f.sim &amp;lt;- vf.sim/vi.sim # Es la misma fórmula&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;“Bueno ¿Y?” se preguntará Ud.&lt;/p&gt;
&lt;p&gt;Veamos que hemos generado con la simulación:&lt;/p&gt;
&lt;ol style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;&lt;span class=&#34;math inline&#34;&gt;\(n = 1000\)&lt;/span&gt; valores aleatorios del volumen inicial a partir de una distribución rectangular con media &lt;code&gt;vi&lt;/code&gt; = 20 mL e incertidumbre expandida &lt;code&gt;Uvi&lt;/code&gt; = 0.1 mL. El promedio de los 1000 volumenes iniciales simulados es 19.999 mL y una desviación estándar de &lt;code&gt;uvi&lt;/code&gt; = &lt;span class=&#34;math inline&#34;&gt;\(U_{vf}/\sqrt{3} = 0.058\)&lt;/span&gt; mL. La figura &lt;a href=&#34;#fig:visim&#34;&gt;2&lt;/a&gt; muestra el histograma de los valores simulados. Note que la simulación concuerda perfectamente con los valores de incertidumbre informados por el fabricante (&lt;span class=&#34;math inline&#34;&gt;\(20 \pm 0.1\)&lt;/span&gt; mL).&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;figure&#34;&gt;&lt;span id=&#34;fig:visim&#34;&gt;&lt;/span&gt;
&lt;img src=&#34;https://www.analytical.cl/post/2017-09-12-validacion-de-los-calculos-de-incertidumbre-en-quimica-analitica-con-el-metodo-monte-carlo_files/figure-html/visim-1.png&#34; alt=&#34;Histograma de los valores simulados de volumen inicial [mL]&#34; width=&#34;672&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;
Figure 2: Histograma de los valores simulados de volumen inicial [mL]
&lt;/p&gt;
&lt;/div&gt;
&lt;ol start=&#34;2&#34; style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;&lt;p&gt;&lt;span class=&#34;math inline&#34;&gt;\(n = 1000\)&lt;/span&gt; valores aleatorios del volumen final a partir de una distribución rectangular con media &lt;code&gt;vf&lt;/code&gt; = 100 mL e incertidumbre expandida &lt;code&gt;Uvf&lt;/code&gt; = 0.6 mL.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Para cada uno de los pares datos simulados de volumen inicial y final, se calculó el factor de dilución, por lo tanto, se obtuvieron en total &lt;span class=&#34;math inline&#34;&gt;\(n = 1000\)&lt;/span&gt; factores los cuales se “guardaron” en el vector &lt;code&gt;f.sim&lt;/code&gt;, tal como se muestra en la tabla &lt;a href=&#34;#tab:fsim&#34;&gt;1&lt;/a&gt;:&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;table&gt;
&lt;caption&gt;&lt;span id=&#34;tab:fsim&#34;&gt;Table 1: &lt;/span&gt;Variables simuladas. Se muestran los primeros 6 datos&lt;/caption&gt;
&lt;thead&gt;
&lt;tr class=&#34;header&#34;&gt;
&lt;th align=&#34;left&#34;&gt;vf.sim&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;vi.sim&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;f.sim&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;left&#34;&gt;99.73&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;19.96&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;5.00&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;left&#34;&gt;100.11&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;20.06&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;4.99&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;left&#34;&gt;99.59&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;19.98&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;4.98&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;left&#34;&gt;100.42&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;20.08&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;5.00&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td align=&#34;left&#34;&gt;100.42&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;20.09&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;5.00&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td align=&#34;left&#34;&gt;99.97&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;19.91&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;5.02&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ol start=&#34;4&#34; style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;La figura &lt;a href=&#34;#fig:fsimhis&#34;&gt;3&lt;/a&gt; muestra el histograma de los 1000 factores de dilución simulados:&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;figure&#34;&gt;&lt;span id=&#34;fig:fsimhis&#34;&gt;&lt;/span&gt;
&lt;img src=&#34;https://www.analytical.cl/post/2017-09-12-validacion-de-los-calculos-de-incertidumbre-en-quimica-analitica-con-el-metodo-monte-carlo_files/figure-html/fsimhis-1.png&#34; alt=&#34;Histograma de factores de dilución simulados&#34; width=&#34;672&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;
Figure 3: Histograma de factores de dilución simulados
&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;“¡Qué interesante!”, dirá Ud., la división de dos variables rectangulares genera una distribución de datos que, al menos, es simétrica. ¿Es razonable asumir una distribución normal del factor de dilución simulado? Si recuerda la discusión en este &lt;a href=&#34;https://www.analytical.cl/post/mis-datos-no-son-normales/&#34;&gt;post&lt;/a&gt;, podemos evaluar la admisibilidad de esta hipótesis mediante el análisis gráfico &lt;em&gt;QQ-Plot&lt;/em&gt; de normalidad de los datos simulados y el test de Shapiro, el cual se muestra en la figura &lt;a href=&#34;#fig:fsimnorm&#34;&gt;4&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&#34;figure&#34;&gt;&lt;span id=&#34;fig:fsimnorm&#34;&gt;&lt;/span&gt;
&lt;img src=&#34;https://www.analytical.cl/post/2017-09-12-validacion-de-los-calculos-de-incertidumbre-en-quimica-analitica-con-el-metodo-monte-carlo_files/figure-html/fsimnorm-1.png&#34; alt=&#34;QQ-Plot de normalidad de los n factores de dilución simulados&#34; width=&#34;672&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;
Figure 4: QQ-Plot de normalidad de los n factores de dilución simulados
&lt;/p&gt;
&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;
    Shapiro-Wilk normality test

data:  f.sim
W = 0.99005, p-value = 2.719e-06&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Aparentemente, el modelo normal sería razonable para modelar el factor de dilución sino fuera por los siguientes hechos:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;El histograma del factor de dilución tiene “colas livianas”, lo cual se puede advertir en el &lt;em&gt;QQ-plot&lt;/em&gt; de normalidad en los valores extremos.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;La evidencia del test de Shapiro en contra de la hipótesis de normalidad.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Y lo más importante, la razón de dos variables independientes rectangulares (uniformes) teóricamente no es Normal (está demostrado).&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Ok, probablemente esta discusión no sea de mucho interés por ahora, pero nos dará pistas para dirigir la discusión posterior.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Entonces ¿Cómo obtenemos la incertidumbre del factor de dilución por el método de Monte Carlo?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Muy sencillo, a partir de la desviación estándar de los factores de dilución simulados, es decir, $u_{f}^{MC} = $ &lt;code&gt;sd(f.sim)&lt;/code&gt; = 0.02302. Como podrá advertir, es muy similar a la obtenida por el método GUM &lt;span class=&#34;math inline&#34;&gt;\(u_{f} = 0.02255\)&lt;/span&gt;, la diferencia relativa es de un 2.1 %. Es más, ajustando a las cifras significativas correctas se obtiene la misma magnitud 0.02&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;¿Queda validado el método GUM con los cálculos del método de Monte Carlo? Desde el punto de vista metrológico químico: Sí. Desde el punto de vista numérico: Depende.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Lo que sucede es que el numeral 8.1 del suplemento 1 dela guía GUM es explícito en establecer un criterio de aceptación entre el método GUM y el método de Monte Carlo (MC):&lt;/p&gt;
&lt;span class=&#34;math display&#34;&gt;\[\begin{eqnarray}
  |y - U(y) - y_{low}| &amp;amp;&amp;lt;&amp;amp; \xi \\
  |y + U(y) - y_{high}| &amp;amp;&amp;lt;&amp;amp; \xi
\end{eqnarray}\]&lt;/span&gt;
&lt;p&gt;donde &lt;span class=&#34;math inline&#34;&gt;\(y \pm U(y)\)&lt;/span&gt; es el valor calculado de la variable y su incertidumbre expandida estimada por el método GUM; &lt;span class=&#34;math inline&#34;&gt;\(y_{low}\)&lt;/span&gt; e &lt;span class=&#34;math inline&#34;&gt;\(y_{high}\)&lt;/span&gt; corresponden a los percentiles 2.5 y 97.5 de los datos simulados, es decir, el intervalo de incertidumbre al 95% de confianza calculado por el método de Monte Carlo. &lt;span class=&#34;math inline&#34;&gt;\(\xi\)&lt;/span&gt; es la tolerancia numérica entre ambas metodologías de cálculo. Es decir, es un test de precisión numérica, no metrológica.&lt;/p&gt;
&lt;p&gt;El valor de &lt;span class=&#34;math inline&#34;&gt;\(\xi\)&lt;/span&gt; está relacionado las cifras significativas que tienen sentido físico-químico y metrológico. Por ejemplo, si para una gravimetría usamos una balanza granataria cuya incertidumbre es del orden de &lt;span class=&#34;math inline&#34;&gt;\(\pm 0.1\)&lt;/span&gt; g, no podríamos elegir una tolerancia numérica de &lt;span class=&#34;math inline&#34;&gt;\(0.00001\)&lt;/span&gt; g. Para establecer &lt;span class=&#34;math inline&#34;&gt;\(\xi\)&lt;/span&gt; la guía indica lo siguiente:&lt;/p&gt;
&lt;ol style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;&lt;p&gt;Exprese &lt;span class=&#34;math inline&#34;&gt;\(u(y)\)&lt;/span&gt; en notación científica manteniendo las cifras significativas. En nuestro caso obtuvimos &lt;span class=&#34;math inline&#34;&gt;\(u_{f} = 0.0225\)&lt;/span&gt;, la cual puede ser redondeada a una cifra significativa &lt;span class=&#34;math inline&#34;&gt;\(u_{f} = 0.02\)&lt;/span&gt;. Esta incertidumbre, entonces, se expresa como &lt;span class=&#34;math inline&#34;&gt;\(2 \cdot 10^{-2}\)&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Para obtener &lt;span class=&#34;math inline&#34;&gt;\(\xi\)&lt;/span&gt;, utilice el exponente de la potencia de 10 (t = -2) del paso anterior, en la siguiente expresión:&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;span class=&#34;math display&#34;&gt;\[\begin{eqnarray}
  \xi &amp;amp;=&amp;amp; \frac{1}{2}\times 10^{t} \\
  \xi &amp;amp;=&amp;amp; \frac{1}{2}\times 10^{-2}\\
  \xi &amp;amp;=&amp;amp; 0.005
\end{eqnarray}\]&lt;/span&gt;
&lt;blockquote&gt;
&lt;p&gt;¿Cómo obtenemos los percentiles 2.5 y 97.5 de la simulación de Monte Carlo?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Muy sencillo, con el comando &lt;code&gt;quantile&lt;/code&gt;:&lt;/p&gt;
&lt;p&gt;Esto quiere decir, que de los &lt;span class=&#34;math inline&#34;&gt;\(n = 1000\)&lt;/span&gt; datos simulados del factor de dilución, un 95% se encuentra dentro del intervalo [4.96, 5.04]. La figura &lt;a href=&#34;#fig:quantilofig&#34;&gt;5&lt;/a&gt; muestra este intervalo en el histograma de los datos simulados:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;hist(f.sim, 
     xlab = &amp;#39;Factor de dilución&amp;#39;,
     main = &amp;#39;&amp;#39;,
     freq = T,
     breaks = 20,
     xlim = c(4.93, 5.07))

abline(v = quantilos[1], col = &amp;#39;red&amp;#39;)
abline(v = quantilos[2], col = &amp;#39;red&amp;#39;)&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&#34;figure&#34;&gt;&lt;span id=&#34;fig:quantilofig&#34;&gt;&lt;/span&gt;
&lt;img src=&#34;https://www.analytical.cl/post/2017-09-12-validacion-de-los-calculos-de-incertidumbre-en-quimica-analitica-con-el-metodo-monte-carlo_files/figure-html/quantilofig-1.png&#34; alt=&#34;Intervalo de confianza al 95% de los datos simulados del factor de dilución&#34; width=&#34;672&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;
Figure 5: Intervalo de confianza al 95% de los datos simulados del factor de dilución
&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Por lo tanto, sólo nos queda calcular &lt;span class=&#34;math inline&#34;&gt;\(U(y)\)&lt;/span&gt; que es la incertidumbre expandida del factor de dilución calculada por el método GUM. De acuerdo a la guía &lt;span class=&#34;math inline&#34;&gt;\(U = k\cdot u\)&lt;/span&gt;, donde &lt;span class=&#34;math inline&#34;&gt;\(k\)&lt;/span&gt; es el factor de cobertura para obtener un intervalo de incertidumbre con cierto grado de confianza. Aquí es donde la guía GUM asume, bajo ciertas condiciones (ver numeral G.2.3), que la variable de respuesta, en este caso factor de dilución, puede aproximarse a una distribución Normal donde &lt;span class=&#34;math inline&#34;&gt;\(k \approx 2\)&lt;/span&gt;. Advierta que para nuestro ejemplo esta suposición no tiene mucho asidero. Por lo tanto, siguiendo las directrices de la guía GUM &lt;span class=&#34;math inline&#34;&gt;\(U_{f} = 2\cdot 0.023 = 0.05\)&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;Con todos los datos estimados, llevemos a cabo el test de validación entre el método GUM y el método de Monte Carlo:&lt;/p&gt;
&lt;span class=&#34;math display&#34;&gt;\[\begin{eqnarray}
  |5 - 0.045 - 4.957| &amp;amp;&amp;lt;&amp;amp; 0.005 \\
  |5 + 0.045 - 5.043| &amp;amp;&amp;lt;&amp;amp; 0.005
\end{eqnarray}\]&lt;/span&gt;
&lt;blockquote&gt;
&lt;p&gt;En ambos casos &lt;span class=&#34;math inline&#34;&gt;\(0.002 &amp;lt; 0.005\)&lt;/span&gt;, por lo tanto, el método GUM queda validado&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;em&gt;Insisto con lo del mago Tamariz: ¡chiararáaa!&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Observaciones:&lt;/p&gt;
&lt;ol style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;&lt;p&gt;Si bien en este ejemplo sólo utilizamos &lt;span class=&#34;math inline&#34;&gt;\(n = 1000\)&lt;/span&gt; simulaciones, en la práctica se requieren muchas más (&lt;span class=&#34;math inline&#34;&gt;\(10^{5} - 10^{6}\)&lt;/span&gt;). El suplemento 1 de la GUM entrega más directrices en este tema.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Mientras mayor sea el grado de no linealidad de la ecuación de medición, más divergencias habrá entre GUM y MC. Siendo este último el de mayor generalidad.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Si bien se puede implementar Monte Carlo en Excel, es una tarea bastante engorrosa pues debe programarlo en Visual Basic. Le sugiero utilizar lenguajes de programación más modernos como &lt;code&gt;R&lt;/code&gt; o &lt;code&gt;Python&lt;/code&gt;, los cuales tienen librerías especializadas en métodos de simulación.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;A mayor asimetría de la distribución empírica, mayores diferencias habrá entre ambos métodos.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Dé un sentido químico a la simulación ¿&lt;a href=&#34;https://www.analytical.cl/post/mis-datos-no-son-normales/&#34;&gt;Recuerda que la pureza química no es Normal&lt;/a&gt;? Intente con la distribución Beta la cual es más apropiada para modelar pureza.&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;En este post hemos validado el método GUM frente a Monte Carlo “a mano”, es decir, hemos hecho el test en forma manual. En el &lt;a href=&#34;https://www.analytical.cl/post/validacion-calculos-incertidumbre-quimica-analitica-metodo-monte-carlo/&#34;&gt;próximo post&lt;/a&gt; utilizaremos la librería &lt;code&gt;metRology&lt;/code&gt; la cual incorpora la validación de GUM con MC en un único comando &lt;code&gt;GUM.validate&lt;/code&gt;… ¡y listo!.&lt;/p&gt;
&lt;p&gt;Hasta la próxima.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;bibliografia&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Bibliografía&lt;/h2&gt;
&lt;ol style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;&lt;p&gt;Evaluation of measurement data – Guide to the expression of uncertainty in measurement JCGM 100:2008&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Evaluation of measurement data – Supplement 1 to the “Guide to the expression of uncertainty in measurement” – Propagation of distributions using a Monte Carlo method JCGM 101:2008&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Stephen L R Ellison &lt;em&gt;metRology: Support for Metrological Applications&lt;/em&gt; R package version 0.9-23-2, 2016.&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>¿Cómo calcular la incertidumbre de una curva de calibración?</title>
      <link>https://www.analytical.cl/post/como-calcular-la-incertidumbre-de-una-curva-de-calibracion/</link>
      <pubDate>Mon, 14 Aug 2017 00:00:00 +0000</pubDate>
      
      <guid>https://www.analytical.cl/post/como-calcular-la-incertidumbre-de-una-curva-de-calibracion/</guid>
      <description>&lt;p&gt;Ok, este es el segundo post pero advierto que aún está en rodaje… esto del &lt;em&gt;copywriting&lt;/em&gt; no es nada fácil.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;¿Qué es y cómo estimar la incertidumbre de una curva de calibración?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;La incertidumbre de calibración, en adelante &lt;span class=&#34;math inline&#34;&gt;\(u(x_{0})\)&lt;/span&gt;, es aquella que se propaga cuando obtenemos la concentración de un mensurando al &lt;em&gt;interpolar&lt;/em&gt; una señal instrumental (por ejemplo, absorbancia o área cromatográfica) en una curva de calibración. Básicamente, esta incertidumbre sólo da cuenta del error aleatorio del instrumento y no incopora la incertidumbre de los calibrantes, al menos cuando se utiliza el modelo de calibración clásico:&lt;/p&gt;
&lt;span class=&#34;math display&#34; id=&#34;eq:lin&#34;&gt;\[\begin{equation}
  y = \beta_{0} + \beta_{1} x + \epsilon
    \tag{1}
\end{equation}\]&lt;/span&gt;
&lt;p&gt;donde &lt;span class=&#34;math inline&#34;&gt;\(y\)&lt;/span&gt; es la respuesta instrumental, &lt;span class=&#34;math inline&#34;&gt;\(\beta_{0}\)&lt;/span&gt; es el intercepto, &lt;span class=&#34;math inline&#34;&gt;\(\beta_{1}\)&lt;/span&gt; es la pendiente y &lt;span class=&#34;math inline&#34;&gt;\(\epsilon\)&lt;/span&gt; es un error aleatorio Normal que tiene media &lt;span class=&#34;math inline&#34;&gt;\(\mu_{\epsilon} = 0\)&lt;/span&gt; y varianza &lt;span class=&#34;math inline&#34;&gt;\(\sigma_{y/x}^2\)&lt;/span&gt;. Note de la ecuación &lt;a href=&#34;#eq:lin&#34;&gt;(1)&lt;/a&gt; que lo único aleatorio es &lt;span class=&#34;math inline&#34;&gt;\(\epsilon\)&lt;/span&gt;, por lo tanto, el intercepto &lt;span class=&#34;math inline&#34;&gt;\(\beta_{0}\)&lt;/span&gt; y la pendiente &lt;span class=&#34;math inline&#34;&gt;\(\beta_{1}\)&lt;/span&gt; son &lt;em&gt;fijos&lt;/em&gt;. Lo que hacemos cuando aplicamos, por ejemplo, el método de los mínimos cuadrados es estimar estos parámetros y, en estadística, todas las estimaciones tienen un error asociado.&lt;/p&gt;
&lt;p&gt;A partir de la ecuación &lt;a href=&#34;#eq:lin&#34;&gt;(1)&lt;/a&gt; obtenemos la concentración de una muestra problema &lt;span class=&#34;math inline&#34;&gt;\(x_{0}\)&lt;/span&gt; cuya señal instrumental es &lt;span class=&#34;math inline&#34;&gt;\(y_{0}\)&lt;/span&gt;:&lt;/p&gt;
&lt;span class=&#34;math display&#34; id=&#34;eq:x0&#34;&gt;\[\begin{equation}
  x_{0} = \frac{y_{0} - \beta_{0}}{\beta_{1}}
    \tag{2}
\end{equation}\]&lt;/span&gt;
&lt;p&gt;Si aplicáramos la guía GUM para obtener la incertidumbre estándar de calibración &lt;span class=&#34;math inline&#34;&gt;\(u(x_{0})\)&lt;/span&gt; sería bastante latoso-engorroso, pues hay unas covarianzas no muy amistosas entre pendiente e intercepto. Afortunadamente &lt;span class=&#34;math inline&#34;&gt;\(u(x_{0})\)&lt;/span&gt; puede aproximarse muy bien a través de la ecuación &lt;a href=&#34;#eq:ux0&#34;&gt;(3)&lt;/a&gt;:&lt;/p&gt;
&lt;span class=&#34;math display&#34; id=&#34;eq:ux0&#34;&gt;\[\begin{equation}
  u(x_{0}) = \frac{\sigma_{y/x}}{\beta_{1}}
  \sqrt{\frac{1}{n} + \frac{1}{m_{0}} + \frac{(x_{0} - \overline{x})^2}
  {\sum_{i}^{n} (x_{i} - \overline{x})^2}}
    \tag{3}
\end{equation}\]&lt;/span&gt;
&lt;p&gt;Vamos viendo dijo el ciego:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;span class=&#34;math inline&#34;&gt;\(\sigma_{y/x}\)&lt;/span&gt; es la desviación estándar del error aleatorio &lt;span class=&#34;math inline&#34;&gt;\(\epsilon\)&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;&lt;span class=&#34;math inline&#34;&gt;\(n\)&lt;/span&gt; es el número de calibrantes independientes (esto da para otro post)&lt;/li&gt;
&lt;li&gt;&lt;span class=&#34;math inline&#34;&gt;\(m_{0}\)&lt;/span&gt; es el número de replicado independientes de la muestra problema&lt;/li&gt;
&lt;li&gt;&lt;span class=&#34;math inline&#34;&gt;\(\overline{x}\)&lt;/span&gt; es el promedio de la concentraciones de los calibrantes&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Esta incertidumbre se puede observar en la figura &lt;a href=&#34;#fig:banda&#34;&gt;1&lt;/a&gt;, la cual fue obtenida mediante simulación en lenguaje &lt;code&gt;R&lt;/code&gt;:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;set.seed(123)
x &amp;lt;- 1:10
y &amp;lt;- 2 + 5*x + 10*rnorm(length(x), 0, 1)
d &amp;lt;- data.frame(x, y)

library(ggplot2)

ggplot(d, aes(x = x, y = y)) +
  geom_smooth(method = &amp;#39;lm&amp;#39;) &lt;/code&gt;&lt;/pre&gt;
&lt;div class=&#34;figure&#34;&gt;&lt;span id=&#34;fig:banda&#34;&gt;&lt;/span&gt;
&lt;img src=&#34;https://www.analytical.cl/post/2017-08-13-como-calcular-la-incertidumbre-de-una-curva-de-calibración_files/figure-html/banda-1.png&#34; alt=&#34;Incertidumbre de calibración&#34; width=&#34;672&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;
Figure 1: Incertidumbre de calibración
&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;¿Dónde se obtiene la menor incertidumbre de calibración? … ¡Correcto!&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;En el centro de la curva se minimiza la incertidumbre de calibración&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Si obervamos la ecuación &lt;a href=&#34;#eq:ux0&#34;&gt;(3)&lt;/a&gt; podemos minimizar &lt;span class=&#34;math inline&#34;&gt;\(u(x_{0})\)&lt;/span&gt;:&lt;/p&gt;
&lt;ol style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;Aumentando &lt;span class=&#34;math inline&#34;&gt;\(n\)&lt;/span&gt; el número de calibrantes.&lt;/li&gt;
&lt;li&gt;Aumentando &lt;span class=&#34;math inline&#34;&gt;\(m_{0}\)&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;Diseñando la curva de calibración de modo que &lt;span class=&#34;math inline&#34;&gt;\(x_{0} = \bar{x}\)&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;Aunque no tan “evidente”, maximizando &lt;span class=&#34;math inline&#34;&gt;\(\sum_{i}^{n} (x_{i} - \overline{x})^2\)&lt;/span&gt;, es decir, utilizando todo el rango lineal (Nota mental: otro post)&lt;/li&gt;
&lt;/ol&gt;
&lt;div id=&#34;aplicacion-a-un-caso-real&#34; class=&#34;section level1&#34;&gt;
&lt;h1&gt;Aplicación a un caso “real”&lt;/h1&gt;
&lt;p&gt;La tabla &lt;a href=&#34;#tab:tabla&#34;&gt;1&lt;/a&gt; muestra los datos de una curva de calibración para la determinación de cobre en mineral por AAS, la figura &lt;a href=&#34;#fig:cal&#34;&gt;2&lt;/a&gt; describe el gráfico de calibración:&lt;/p&gt;
&lt;div class=&#34;alert alert-note&#34;&gt;
  &lt;p&gt;Alguien capo en HTML/CSS que me ayude a poner tabla enfrentada con figura en 2 columnas por favor… y que Dios se lo pague.&lt;/p&gt;

&lt;/div&gt;

&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;
&lt;table class=&#34;table&#34; style=&#34;width: auto !important; text-align: right;&#34;&gt;
&lt;caption&gt;
&lt;span id=&#34;tab:tabla&#34;&gt;Table 1: &lt;/span&gt;Curva de Calibración Cu
&lt;/caption&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center;&#34;&gt;
Cu [ppm]
&lt;/th&gt;
&lt;th style=&#34;text-align:center;&#34;&gt;
UA
&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center;&#34;&gt;
1
&lt;/td&gt;
&lt;td style=&#34;text-align:center;&#34;&gt;
0.0344
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center;&#34;&gt;
2
&lt;/td&gt;
&lt;td style=&#34;text-align:center;&#34;&gt;
0.0777
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center;&#34;&gt;
3
&lt;/td&gt;
&lt;td style=&#34;text-align:center;&#34;&gt;
0.1356
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center;&#34;&gt;
4
&lt;/td&gt;
&lt;td style=&#34;text-align:center;&#34;&gt;
0.1607
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center;&#34;&gt;
5
&lt;/td&gt;
&lt;td style=&#34;text-align:center;&#34;&gt;
0.2013
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center;&#34;&gt;
6
&lt;/td&gt;
&lt;td style=&#34;text-align:center;&#34;&gt;
0.2572
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center;&#34;&gt;
7
&lt;/td&gt;
&lt;td style=&#34;text-align:center;&#34;&gt;
0.2846
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center;&#34;&gt;
8
&lt;/td&gt;
&lt;td style=&#34;text-align:center;&#34;&gt;
0.3073
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center;&#34;&gt;
9
&lt;/td&gt;
&lt;td style=&#34;text-align:center;&#34;&gt;
0.3531
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center;&#34;&gt;
10
&lt;/td&gt;
&lt;td style=&#34;text-align:center;&#34;&gt;
0.3955
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;div class=&#34;figure&#34;&gt;&lt;span id=&#34;fig:cal&#34;&gt;&lt;/span&gt;
&lt;img src=&#34;https://www.analytical.cl/post/2017-08-13-como-calcular-la-incertidumbre-de-una-curva-de-calibración_files/figure-html/cal-1.png&#34; alt=&#34;Curva de calibración&#34; width=&#34;672&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;
Figure 2: Curva de calibración
&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Ok, hay varias formas de implementar los cálculos de incertidumbre de calibración de la ecuación &lt;a href=&#34;#eq:ux0&#34;&gt;(3)&lt;/a&gt;. Podríamos utilizar Excel para obtener cada uno de los términos, pero eso lo ilustraremos en otro post. En esta oportunidad utilizaremos el software &lt;code&gt;R&lt;/code&gt;. Este software posee varias librerías o packages especializados en el cálculo de incertidumbre en química analítica, por ejemplo: &lt;code&gt;metRology&lt;/code&gt; y &lt;code&gt;chemCal&lt;/code&gt;. En este post utilizaremos el segundo, pues entrega en forma directa el cálculo de la incertidumbre de calibración:&lt;/p&gt;
&lt;div class=&#34;alert alert-warning&#34;&gt;
  &lt;p&gt;Si no tienes instalado el package &lt;code&gt;chemCal&lt;/code&gt; utiliza el comando &lt;code&gt;install.packages(&amp;lsquo;chemCal&amp;rsquo;)&lt;/code&gt;. Una vez instalado procede con el siguiente código.&lt;/p&gt;

&lt;/div&gt;

&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# Creación del modelo de calibración lineal, al que llamaremos fit.lin 
# (En otro post se profundizará sobre otros modelos de calibración en R)

fit.lin &amp;lt;- lm(y ~ x, data = d)

# Simular un valor de respuesta de la muestra problema, es decir, y0.
# Sólo por conveniencia simularemos que y0 = 0.200 UA, es decir, más o menos
# en el centro de la curva:

y0 &amp;lt;- 0.200

# Cargar la librería chemCal con el comando &amp;#39;library&amp;#39;:

library(chemCal)

# Calcular la concentración de la muestra problema, x0, a partir de su señal
# instrumental y0, junto con la incertidumbre estándar de calibración u(x0) e
# incertidumbre expandida U(x0) con un 95% de confianza:

inverse.predict(fit.lin, newdata = y0)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;$Prediction
[1] 4.970492

$`Standard Error`
[1] 0.2618792

$Confidence
[1] 0.6038946

$`Confidence Limits`
[1] 4.366598 5.574387&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Bien, interpretemos la salida:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;$Prediction&lt;/code&gt; es la concentración de la muestra problema en [ppm]&lt;/li&gt;
&lt;li&gt;&lt;code&gt;$Standard Error&lt;/code&gt; es la incertidumbre estándar de calibración, es decir, la que se obtiene de la ecuación &lt;a href=&#34;#eq:ux0&#34;&gt;(3)&lt;/a&gt; expresada, obviamente, en las mismas unidades que los calibrantes [ppm].&lt;/li&gt;
&lt;li&gt;&lt;code&gt;$Confidence&lt;/code&gt; es la incertidumbre expandida de calibración &lt;span class=&#34;math inline&#34;&gt;\(U(x0)\)&lt;/span&gt;, es decir, &lt;span class=&#34;math inline&#34;&gt;\(U(x0) = k\cdot u(x0)\)&lt;/span&gt; donde &lt;span class=&#34;math inline&#34;&gt;\(k\)&lt;/span&gt; es el factor de cobertura con el cual se obtiene un intervalo de incertidumbre con cierta confianza (habitualmente 95%). Más de esto en otro post.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;$Confidence Limits&lt;/code&gt; es simplemente &lt;span class=&#34;math inline&#34;&gt;\(x0 \pm U(x0)\)&lt;/span&gt;, es decir, &lt;span class=&#34;math inline&#34;&gt;\(5 \pm 0.6\)&lt;/span&gt; ppm (ojo con las cifras significativas… ahí va otro post).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Algunas consideraciones importantes:&lt;/p&gt;
&lt;ol style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;&lt;p&gt;Esta incertidumbre de calibración &lt;span class=&#34;math inline&#34;&gt;\(u(x0)\)&lt;/span&gt; NO incorpora la incertidumbre de los calibrantes, sólo es un reflejo del error aleatorio instrumental. Punto. Es decir, asume que los calibrantes no tienen incertidumbre… lo cual todos los químicos sabemos que es ¡Farso, farso!&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Si Ud. requiere incorporar también la incertidumbre de los calibrantes, debe utilizar otro modelo lineal de calibración denominado: modelo lineal con error en ambos ejes (otro post).&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Ya que esta incertidumbre sólo refleja el componente aleatorio de la calibración, no están incorporados los errores sistemáticos de la preparación de estándares: error en el aforo, no considerar la pureza del reactivo, etc. (Nota mental: otro post… ¿cuántos van?).&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Si, además, el método analítico incluye pesada de la muestra, digestión o extracción, aforo final, factor de dilución, etc. Ud.debe, mediante los mandamientos de la guía GUM, combinar todas estas fuentes de incertidumbre con la de calibración &lt;span class=&#34;math inline&#34;&gt;\(u(x0)\)&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;En el fondo, como se asume que los calibrantes no tienen incertidumbre, &lt;span class=&#34;math inline&#34;&gt;\(u(x0)\)&lt;/span&gt; reflejaría el comportamiento aleatorio del instrumento cuando se lee la curva “muchas” veces, siempre con los mismos calibrantes. En cada oportunidad, se obtendría una pendiente e intercepto distintos (debido a al error aleatorio &lt;span class=&#34;math inline&#34;&gt;\(\epsilon\)&lt;/span&gt;), por lo tanto, también una concentración &lt;span class=&#34;math inline&#34;&gt;\(x0\)&lt;/span&gt; distinta cada vez.&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Bueno espero que este post, en rodaje áun, haya sido de su agrado. Como siempre, siéntase libre de criticarlo. Nos vemos.&lt;/p&gt;
&lt;/div&gt;
</description>
    </item>
    
  </channel>
</rss>
